# 房间供暖系统的有效控制

**Effective Control of Room Heating**

MATH3060/1 — 应用数学方向，数学小组项目
University of Nottingham, School of Mathematical Sciences
2026 年春季

---

## 摘要 (Abstract)

本报告研究房间供暖系统的数学建模与最优控制问题。我们建立了三种递进复杂度的物理模型——集总参数 ODE 模型、一维热方程 PDE 模型和二维热方程 PDE 模型，并在每种模型上比较了四种控制策略：Bang-Bang 开关控制、PID 连续反馈控制、LQR 线性二次最优控制和 Pontryagin 极小值原理。

研究采用统一的评价指标体系（能耗、温度 RMSE、超调量、稳定时间、切换次数和统一代价函数），通过大量数值实验得出以下核心结论：（1）在集总参数模型中，LQR 和 Pontryagin 策略性能接近且接近理论最优，但充分调参的 PID 可达到相当甚至更低的代价函数值；（2）当引入空间维度后（PDE 模型），恒温器和加热器的**位置**对控制性能的影响远大于控制策略本身的差异；（3）加热器位于房间中心时能最均匀地加热空间。

本项目的代码完全可复现，托管于 GitHub: https://github.com/Yingurt001/RoomHeating-Project

---

## 1. 引言 (Introduction)

### 1.1 问题背景

房间供暖控制是一个经典的工程问题，也是控制理论的理想教学案例。在英国冬季，室外温度约 $T_a = 5°C$，我们需要将室内温度维持在舒适的 $T_{set} = 20°C$。这涉及两个核心问题：

1. **控制策略问题**：采用什么样的加热器控制方式最有效？是简单的开关控制还是连续调节？
2. **传感器放置问题**：恒温器应该放在房间的什么位置？距离加热器远近如何影响控制效果？

### 1.2 研究方法

我们采用从简单到复杂的递进建模方法：

- **ODE 模型 (0D)**：将房间视为均匀温度体，用 Newton 冷却定律建立常微分方程。这是最简单的模型，可以集中研究控制策略本身的优劣。
- **1D PDE 模型**：沿房间长度方向引入空间维度，用一维热方程描述温度分布。此模型可研究加热器和恒温器沿一个方向的最优位置。
- **2D PDE 模型**：建立矩形房间的二维温度场模型，研究全空间的温度分布和位置优化问题。

在每种模型上，我们比较四种控制策略：

| 策略 | 数学核心 | 定位 |
|------|----------|------|
| Bang-Bang + 滞回 | 混合动力系统 | 基线对照 |
| PID 控制 | 闭环反馈 | 工程标准 |
| LQR 最优控制 | Riccati 方程 | 数学最优 |
| Pontryagin 极小值原理 | Hamilton 量和伴随方程 | 理论极限 |

### 1.3 评价指标

所有策略采用统一的六项指标评价：

| 指标 | 数学定义 | 物理含义 |
|------|----------|----------|
| 能耗 $E$ | $\int_0^{T_f} u(t)\,dt$ | 总能量消耗 |
| 温度 RMSE | $\sqrt{\frac{1}{T_f}\int_0^{T_f}(T-T_{set})^2\,dt}$ | 舒适度偏差 |
| 最大超调 | $\max(T(t) - T_{set})$ | 峰值偏差 |
| 稳定时间 | 首次进入 $\pm 0.5°C$ 并保持的时刻 | 响应速度 |
| 切换次数 | 加热器开关转换次数 | 设备磨损 |
| 统一代价 $J$ | $\int_0^{T_f}[Q(T-T_{set})^2 + Ru^2]\,dt$ | 综合权衡 |

统一代价函数 $J$ 通过权重 $Q$ 和 $R$ 平衡舒适度和能耗，是比较不同策略的最核心指标。

---

## 2. ODE 集总参数模型

### 2.1 数学建模

Newton 冷却定律将房间视为温度均匀的热容体：

$$\frac{dT}{dt} = -k(T(t) - T_a) + u(t) \tag{1}$$

其中 $T(t)$ 为室温，$T_a = 5°C$ 为室外温度，$k = 0.1\,\text{min}^{-1}$ 为冷却常数，$u(t) \in [0, U_{max}]$ 为加热器控制输入，$U_{max} = 15\,°C/\text{min}$。

**稳态分析**：令 $dT/dt = 0$，在恒定加热 $u = U_{max}$ 下：

$$T_{ss} = T_a + \frac{U_{max}}{k} = 5 + \frac{15}{0.1} = 155°C \tag{2}$$

远高于 $T_{set} = 20°C$，表明加热器功率充足。

**解析解**：无加热 ($u=0$) 时，方程 (1) 的精确解为：

$$T(t) = T_a + (T_0 - T_a)\exp(-kt) \tag{3}$$

我们用此解析解验证了数值求解器的精度（最大误差 $< 10^{-8}°C$），采用 SciPy 的 `solve_ivp` (RK45 自适应步长方法) [1, 2]。

### 2.2 Bang-Bang 开关控制

最简单的温控方式是带滞回的开关控制 [4, 5]：

$$u(t) = \begin{cases} U_{max}, & T(t) < T_{set} - \delta \\ 0, & T(t) > T_{set} + \delta \\ u(t^-), & \text{其他（保持当前状态）} \end{cases} \tag{4}$$

滞回带半宽 $\delta$ 至关重要：$\delta = 0$ 时系统退化为理想开关，可能出现 Zeno 现象（有限时间内无限次切换）[5]。增大 $\delta$ 可减少切换频率但增大温度波动幅度。

**混合动力系统视角**：方程 (1) 加上切换逻辑 (4) 构成一个混合动力系统——连续温度演化与离散开关事件的耦合。我们使用事件驱动仿真（`solve_ivp` 的 `events` 功能），在温度穿越 $T_{set} \pm \delta$ 时精确切换 [4]。

**数值实验——滞回带扫描**：

| $\delta$ (°C) | 切换次数 | RMSE (°C) | 能耗    |     |
| ------------- | ---- | --------- | ----- | --- |
| 0.10          | 1611 | 0.446     | 189.8 |     |
| 0.25          | 644  | 0.465     | 189.9 |     |
| 0.50          | 322  | 0.527     | 189.4 |     |
| 1.00          | 161  | 0.726     | 189.7 |     |
| 2.00          | 80   | 1.235     | 190.4 |     |
| 5.00          | 31   | 2.938     | 183.2 |     |

能耗几乎不随 $\delta$ 变化（$\approx 190$），因为系统需要的总热量由散热速率决定。但 RMSE 随 $\delta$ 增大而显著增加。$\delta = 0.5°C$ 是一个合理的工程折衷。

### 2.3 PID 控制

PID 控制器提供连续的控制信号 [3, 8]：

$$u(t) = K_p \cdot e(t) + K_i \int_0^t e(\tau)\,d\tau + K_d \frac{de}{dt}, \quad e(t) = T_{set} - T(t) \tag{5}$$

并约束 $u(t) \in [0, U_{max}]$。当 $u$ 饱和时冻结积分项（anti-windup），防止积分器溢出。

**调参方法**：我们对 $K_p \in \{0.5, 1, 2, 4, 8\}$，$K_i \in \{0.05, 0.1, 0.3, 0.5, 1.0\}$，$K_d \in \{0, 0.5, 1.0, 2.0\}$ 共 100 组参数进行网格搜索，以统一代价 $J$ 为优化目标。

**最优参数**：$K_p = 8.0, K_i = 1.0, K_d = 0.0$，对应 $J = 25.0$。

有趣的是，最优 PID 的微分项为零（即退化为 PI 控制器）。这是因为本系统是一阶系统，不存在振荡趋势，微分项的预测抑制作用没有必要。较大的 $K_p$ 确保快速响应，$K_i$ 消除稳态误差。

### 2.4 LQR 最优控制

LQR 最小化无限时域代价函数 [3, 9]：

$$J = \int_0^\infty \left[ Q(T - T_{set})^2 + Ru^2 \right] dt \tag{6}$$

引入偏差变量 $x = T - T_{set}$，系统状态空间为：

$$\dot{x} = Ax + B(u - u_{ss}), \quad A = -k, \quad B = 1 \tag{7}$$

其中稳态前馈 $u_{ss} = k(T_{set} - T_a) = 0.1 \times 15 = 1.5\,°C/\text{min}$。

代数 Riccati 方程 (ARE)：

$$A^T P + PA - PBR^{-1}B^T P + Q = 0 \tag{8}$$

对标量系统，(8) 简化为二次方程 $P^2/R - 2kP - Q = 0$，解为：

$$P = R\left(-k + \sqrt{k^2 + Q/R}\right) \tag{9}$$

最优增益 $K = P/R$，最优控制律为：

$$u^*(t) = u_{ss} + K \cdot (T_{set} - T(t)) \tag{10}$$

并约束到 $[0, U_{max}]$。

**Q/R 权重扫描**：我们扫描了 $Q \in \{0.01, ..., 100\}$ 和 $R \in \{0.001, ..., 5\}$ 共 56 组参数，生成 Pareto 前沿。结果清晰展示了舒适度与能耗的不可避免权衡：$Q/R$ 比值越大，RMSE 越小但能耗越高。

### 2.5 Pontryagin 极小值原理

给定有限时域优化问题 [10, 11]：

$$\min_{u(t)} J = \int_0^{T_f} \left[ Q(T - T_{set})^2 + Ru^2 \right] dt \tag{11}$$

$$\text{s.t.} \quad \dot{T} = -k(T - T_a) + u, \quad u \in [0, U_{max}]$$

构造 Hamilton 量：

$$H = Q(T - T_{set})^2 + Ru^2 + \lambda[-k(T - T_a) + u] \tag{12}$$

Pontryagin 必要条件：

1. **状态方程**：$\dot{T} = -k(T - T_a) + u^*$ （已知）
2. **伴随方程**：$\dot{\lambda} = -2Q(T - T_{set}) + k\lambda$ （新方程）
3. **最优性条件**：$\partial H/\partial u = 0 \Rightarrow u^* = -\lambda/(2R)$，约束到 $[0, U_{max}]$

**边界条件**：$T(0) = T_0$（初始温度），$\lambda(T_f) = 0$（横截性条件）。

这构成一个两点边值问题 (TPBVP)，用 `scipy.solve_bvp` 求解。

**数值挑战与解决方案**：当 $R$ 很小时（强调跟踪精度），伴随变量 $\lambda$ 变化剧烈，BVP 求解器难以收敛。我们采用**延续法 (continuation method)**：

1. 从 $R_0 = 2.0$（容易收敛的"松弛"问题）开始求解
2. 用该解作为初始猜测，减小 $R$ 为 $R_0/3$
3. 重复直到达到目标 $R = 0.01$

延续法序列：$R = 2.0 \to 0.667 \to 0.222 \to 0.074 \to 0.025 \to 0.01$，每步均成功收敛。

### 2.6 ODE 模型综合对比

| 策略 | 能耗 | RMSE (°C) | 超调 (°C) | 稳定时间 (min) | 切换次数 | 代价 $J$ |
|------|------|-----------|-----------|----------------|----------|----------|
| Bang-Bang ($\delta=0.5$) | 189.4 | 0.527 | 0.500 | 120.0 | 322 | 61.8 |
| PID (默认) | 14.6 | 0.647 | 1.837 | 12.0 | 2 | 50.4 |
| LQR ($Q=1, R=0.01$) | 189.6 | 0.442 | 0.000 | 0.7 | 0 | 27.6 |
| Pontryagin ($Q=1, R=0.1$) | 188.9 | 0.454 | 0.000 | 1.1 | 1 | 28.7 |
| **PID (调参后)** | 40.5 | **0.442** | 0.003 | 0.8 | 0 | **25.0** |

**关键发现**：

1. **LQR 和 Pontryagin 性能接近**：RMSE 分别为 0.442 和 0.454，代价分别为 27.6 和 28.7。两者理论上应趋向相同最优解，微小差异来自：LQR 是无限时域稳态反馈，Pontryagin 是有限时域开环控制。

2. **充分调参的 PID 可匹敌最优控制**：最优 PID ($K_p=8, K_i=1, K_d=0$) 的代价 $J=25.0$ 甚至低于 LQR ($J=27.6$)。这并非悖论——PID 通过积分项自适应地补偿了系统偏差，而 LQR/Pontryagin 的 $Q$ 和 $R$ 权重与评价指标中使用的默认权重 ($Q=1, R=0.01$) 不完全匹配。

3. **Bang-Bang 的代价最高** ($J=61.8$)：虽然简单鲁棒，但频繁切换（322次）和持续振荡使其在所有指标上都劣于连续控制器。

---

## 3. 一维 PDE 模型

### 3.1 从 ODE 到 PDE：引入空间维度

ODE 模型的关键假设——房间温度处处均匀——在实际中并不成立。加热器附近温度明显高于远端墙壁。为捕捉这一空间非均匀性，我们沿房间长度 $L = 5\text{m}$ 方向建立一维热方程 [7]：

$$\frac{\partial T}{\partial t} = \alpha \frac{\partial^2 T}{\partial x^2} + S(x, t) \tag{13}$$

其中 $\alpha = 0.01\,\text{m}^2/\text{min}$ 是空气热扩散率，$S(x,t)$ 是空间分布的热源。

**加热器模型**：采用高斯空间分布：

$$S(x,t) = \frac{u(t)}{L} \cdot \phi(x), \quad \phi(x) \propto \exp\left(-\frac{(x - x_h)^2}{2\sigma^2}\right) \tag{14}$$

归一化使得 $\int_0^L \phi(x)\,dx = L$，确保总加热功率等于 ODE 模型中的 $u(t)$。

**边界条件** (Robin 型，模拟墙壁散热)：

$$-\alpha \frac{\partial T}{\partial x}\bigg|_{x=0} = h(T(0,t) - T_a), \quad \alpha \frac{\partial T}{\partial x}\bigg|_{x=L} = h(T(L,t) - T_a) \tag{15}$$

其中 $h = 0.5\,\text{m}^{-1}$ 是墙壁传热系数。

### 3.2 数值方法

采用**线方法 (Method of Lines)**：

1. **空间离散**：将 $[0, L]$ 等分为 $N_x = 51$ 个网格点，间距 $\Delta x = L/(N_x-1)$
2. **中心差分**：$\frac{\partial^2 T}{\partial x^2}\bigg|_{x_i} \approx \frac{T_{i+1} - 2T_i + T_{i-1}}{\Delta x^2}$
3. **Robin BC**：用虚拟点 (ghost point) 方法处理，例如左壁：

$$\frac{dT_0}{dt} = \alpha \frac{2T_1 - 2T_0 - 2\Delta x \cdot h \cdot (T_0 - T_a)}{\Delta x^2} + S_0$$

4. **时间积分**：将空间离散后得到的 $N_x$ 个 ODE 交给 `solve_ivp` (RK45)

### 3.3 恒温器位置实验

加热器固定在 $x_h = 0.5\text{m}$（左墙附近），扫描恒温器位置 $x_{th} \in \{0.5, 1.5, 2.5, 3.5, 4.5\}\text{m}$。

**PID 控制器结果**：

| 恒温器位置 $x_{th}$ | RMSE (°C) | 稳定时间 | 能耗 |
|---|---|---|---|
| 0.5m（靠近加热器）| 1.405 | 15.2 min | 1.4 |
| 1.5m | 27.084 | 未稳定 | 152.7 |
| 2.5m（中间）| 8.545 | 未稳定 | 609.3 |
| 3.5m | 9.727 | 未稳定 | 900.0 |
| 4.5m（最远端）| 10.465 | 未稳定 | 900.0 |

**LQR 控制器结果**（趋势一致）：

| 恒温器位置 $x_{th}$ | RMSE (°C) | 稳定时间 | 能耗 |
|---|---|---|---|
| 0.5m | 0.506 | 0.5 min | 19.4 |
| 2.5m | 8.534 | 未稳定 | 629.2 |
| 4.5m | 10.465 | 未稳定 | 900.0 |

**分析与反思**：

当恒温器远离加热器时（$x_{th} \geq 2.5\text{m}$），热量必须先扩散到恒温器位置。由于扩散速度有限且墙壁持续散热，恒温器处的温度始终低于 $T_{set}$，控制器被迫以最大功率持续加热（能耗趋向理论上限 $U_{max} \cdot T_f = 15 \times 60 = 900$），但仍然无法达标。

反之，恒温器靠近加热器时 ($x_{th} = 0.5\text{m}$)，控制器能精确调节本地温度，但**房间远端的实际温度远低于设定值**。这揭示了单点测量控制的根本局限。

### 3.4 加热器位置实验

固定恒温器在中心 $x_{th} = 2.5\text{m}$，扫描加热器位置：

| 加热器位置 $x_h$  | RMSE (°C) | 稳定时间         | 能耗      |
| ------------ | --------- | ------------ | ------- |
| 0.5m（左墙）     | 8.545     | 未稳定          | 609.3   |
| 1.5m         | 24.178    | 未稳定          | 153.8   |
| **2.5m（中心）** | **1.316** | **12.4 min** | **1.6** |
| 3.5m         | 24.178    | 未稳定          | 153.8   |
| 4.5m（右墙）     | 8.545     | 未稳定          | 609.3   |

结果呈完美对称性（因为房间几何和边界条件对称）。**加热器在中心时性能最优**，RMSE 从 8.5°C 降至 1.3°C，能耗从 609 降至 1.6——差距超过两个数量级。

**物理解释**：中心放置的加热器到两面墙壁的距离最短，热量扩散路径最短，温度场最均匀。墙壁处的加热器使另一端几乎无法被加热。

---

## 4. 二维 PDE 模型

### 4.1 数学模型

将房间建模为 $L_x \times L_y = 5\text{m} \times 4\text{m}$ 的矩形域 [7]：

$$\frac{\partial T}{\partial t} = \alpha \left(\frac{\partial^2 T}{\partial x^2} + \frac{\partial^2 T}{\partial y^2}\right) + S(x, y, t) \tag{16}$$

四面墙壁均采用 Robin 边界条件：

$$-\alpha \frac{\partial T}{\partial \mathbf{n}}\bigg|_{\text{wall}} = h(T_{\text{wall}} - T_a) \tag{17}$$

加热器为二维高斯分布：

$$S(x,y,t) = \frac{u(t)}{L_x L_y} \cdot \psi(x,y), \quad \psi \propto \exp\left(-\frac{(x-x_h)^2 + (y-y_h)^2}{2\sigma^2}\right) \tag{18}$$

### 4.2 数值方法

在 $21 \times 17$ 的网格上，用二维中心差分离散 Laplacian：

$$\nabla^2 T\big|_{i,j} \approx \frac{T_{i+1,j} - 2T_{i,j} + T_{i-1,j}}{\Delta x^2} + \frac{T_{i,j+1} - 2T_{i,j} + T_{i,j-1}}{\Delta y^2} \tag{19}$$

四面墙壁和四个角点分别用 Robin BC 的 ghost-point 方法处理。将 $21 \times 17 = 357$ 个网格点的温度值展平为一维向量，交给 `solve_ivp` 求解。

### 4.3 恒温器位置实验

加热器固定于 $(0.5, 2.0)$（左墙中部），比较不同恒温器位置：

| 配置    | 恒温器坐标      | RMSE (°C) | 能耗    | 稳定时间    |
| ----- | ---------- | --------- | ----- | ------- |
| 靠近加热器 | (1.0, 2.0) | 1.186     | 3.5   | 3.5 min |
| 房间中心  | (2.5, 2.0) | 8.824     | 450.0 | 未稳定     |
| 远端角落  | (4.5, 3.5) | 9.653     | 450.0 | 未稳定     |
| 靠近墙壁  | (2.5, 0.3) | 9.455     | 450.0 | 未稳定     |
| 对面墙壁  | (4.5, 2.0) | 9.399     | 450.0 | 未稳定     |

结论与 1D 模型一致：恒温器远离加热器时控制性能急剧恶化。

### 4.4 加热器位置实验

固定恒温器在中心 $(2.5, 2.0)$：

| 加热器位置 | RMSE (°C) | 能耗 | 稳定时间 |
|------------|-----------|------|----------|
| 角落 (0.5, 0.5) | 9.811 | 450.0 | 未稳定 |
| 墙壁中部 (0.5, 2.0) | 8.824 | 450.0 | 未稳定 |
| **中心 (2.5, 2.0)** | **1.187** | **20.9** | **4.5 min** |
| 对面墙壁 (4.5, 2.0) | 8.824 | 450.0 | 未稳定 |

**加热器放在中心是唯一能让系统稳定的配置**。这与 1D 模型的结论完全一致，并且在 2D 中更加显著——角落放置比墙壁中部更差，因为热量需要向两个方向扩散。

### 4.5 空间均匀性分析

对中心恒温器 + 墙壁加热器（(0.5, 2.0)）的配置，分析温度场的空间统计量：

- 最终时刻空间温差（max - min）约为 5-8°C
- 恒温器读数与空间平均温度之差约为 2-3°C
- 空间标准差随时间先增大（加热器局部加温）后趋于稳定

**核心洞察**：即使恒温器读数达到 $T_{set}$，房间内仍有部分区域温度显著偏低。单点传感器无法代表全房间的热舒适度——这是"恒温器放在哪"问题的物理本质。

### 4.6 控制策略对比（2D）

在中心恒温器配置下，三种控制策略的比较：

| 控制器 | RMSE (°C) | 能耗 | 代价 $J$ |
|--------|-----------|------|----------|
| Bang-Bang | 8.993 | 450.0 | 2483.0 |
| PID | 8.824 | 450.0 | 2403.6 |
| LQR | 8.824 | 450.0 | 2403.6 |

在 2D 模型中，三种策略的表现几乎没有差异——它们都被空间扩散的物理限制所主导。这进一步证实了我们的核心发现：**在空间模型中，位置比策略更重要**。

---

## 5. Pontryagin 最优控制的数值方法

### 5.1 BVP 的数值困难

Pontryagin 极小值原理要求求解两点边值问题 (TPBVP)：

$$\begin{cases} \dot{T} = -k(T - T_a) + u^*(\lambda) \\ \dot{\lambda} = -2Q(T - T_{set}) + k\lambda \end{cases} \tag{20}$$

边界条件：$T(0) = T_0, \lambda(T_f) = 0$。

当 $R$ 很小时，$u^* = \text{clip}(-\lambda/(2R), 0, U_{max})$ 对 $\lambda$ 非常敏感，导致伴随方程变得**刚性**——$\lambda$ 在短时间内急剧变化，BVP 求解器需要极细的网格才能分辨。

### 5.2 延续法 (Continuation Method)

我们的解决方案是参数延续：

1. 先求解 $R = 2.0$ 的"松弛"问题（$u^*$ 对 $\lambda$ 的灵敏度低，容易收敛）
2. 用该解作为下一步的初始猜测，将 $R$ 除以 3
3. 重复直到达到目标 $R$

对 $R = 0.01$，完整序列为：$R = 2.0 \to 0.667 \to 0.222 \to 0.074 \to 0.025 \to 0.01$

每步均在 800-870 个网格节点上成功收敛。没有延续法时，直接求解 $R = 0.01$ 的 BVP 完全不收敛。

### 5.3 与 LQR 的理论关系

在无约束 ($u \in (-\infty, +\infty)$) 和无限时域 ($T_f \to \infty$) 的极限下，Pontryagin 解应与 LQR 解重合 [3, 10]。我们的数值结果中两者的微小差异（$J_{LQR} = 27.6$ vs $J_{Pont} = 28.7$）来自：

1. Pontryagin 有限时域（$T_f = 120$ min），终端附近控制力减弱（$\lambda \to 0$）
2. 控制约束 $u \in [0, U_{max}]$ 在初期激活（满功率加热），略微偏离无约束最优
3. BVP 求解器的数值容差（$\text{tol} = 10^{-4}$）

---

## 6. 实验方法与代码实现

### 6.1 代码架构

项目采用**模型-控制器解耦**的架构设计：

```
models/          ← 纯物理模型（给定 u(t)，求解 T(t)）
controllers/     ← 纯控制逻辑（给定 T(t)，输出 u(t)）
experiments/     ← 组合模型+控制器的实验脚本
utils/           ← 共享参数、指标计算、绘图工具
```

任何控制器可搭配任何模型运行，通过统一接口 `controller.get_u(t, T)` 实现。

### 6.2 关键数值方法

| 组件 | 方法 | 工具 |
|------|------|------|
| ODE 求解 | RK45 自适应步长 | `scipy.solve_ivp` |
| PDE 空间离散 | 中心差分 + Robin BC ghost-point | NumPy 向量化 |
| PDE 时间积分 | Method of Lines → RK45 | `scipy.solve_ivp` |
| ARE 求解 | Schur 分解法 | `scipy.linalg.solve_continuous_are` |
| BVP 求解 | 基于配置的 BVP 求解器 + 延续法 | `scipy.solve_bvp` |
| Bang-Bang 事件 | 事件驱动仿真 | `solve_ivp(events=...)` |

### 6.3 可复现性

完整代码托管于 GitHub: https://github.com/Yingurt001/RoomHeating-Project

运行方式：
```bash
pip install numpy scipy matplotlib pytest
cd Code
python -m pytest tests/ -v        # 38 个测试全部通过
python experiments/exp_ode_comparison.py   # ODE 实验
python experiments/exp_1d_placement.py     # 1D 实验
python experiments/exp_2d_placement.py     # 2D 实验
```

---

## 7. 讨论

### 7.1 从 0D 到 2D 的认知递进

本项目最重要的方法论贡献是展示了逐步复杂化建模的价值：

| 模型维度 | 新增物理效应 | 新增洞察 |
|----------|-------------|----------|
| ODE (0D) | — | 控制策略本身的优劣：LQR/Pontryagin > PID > Bang-Bang |
| 1D PDE | 空间扩散、位置效应 | 恒温器/加热器位置决定性能；位置 > 策略 |
| 2D PDE | 二维扩散、角落效应 | 中心放置最优；空间均匀性是关键挑战 |

每一步复杂化都揭示了新的物理机制，而非简单的精度提升。这是应用数学建模的核心思想："所有模型都是错的，但有些是有用的。"

### 7.2 控制策略的适用场景

| 场景 | 推荐策略 | 理由 |
|------|----------|------|
| 简单家用恒温器 | Bang-Bang ($\delta = 0.5°C$) | 实现最简单，鲁棒性好 |
| 精密温控（实验室） | PID（充分调参）| 零超调、快速稳定、无需精确模型 |
| 已知精确模型 | LQR | 数学最优，自动权衡能耗与舒适度 |
| 有限时域优化 | Pontryagin | 理论最严谨，但数值实现困难 |

### 7.3 局限与未来工作

1. **模型简化**：实际房间有家具、窗户（不同传热系数）、人体热源等，我们的均匀介质假设过于简化。
2. **控制器假设**：LQR 和 Pontryagin 基于完美模型知识，实际中模型参数有不确定性。鲁棒控制（$H_\infty$）或自适应控制是自然延伸。
3. **加热器模型**：真实暖气片的热响应有时间延迟，非瞬时功率切换。
4. **多区域控制**：大型建筑可划分为多个控制区域，需要分布式或协调控制。
5. **MPC 作为下一步**：模型预测控制 (MPC) 可以在每个时间步重新优化，天然处理约束和扰动，是 LQR/Pontryagin 的现代工程延伸。

---

## 8. 结论

本项目通过从 ODE 到 2D PDE 的递进建模和四种控制策略的系统比较，得出以下核心结论：

1. **在集总参数 (ODE) 模型中**，LQR 和 Pontryagin 最优控制达到最低代价（$J \approx 27$-$28$），但充分调参的 PID 可达到 $J = 25$，这表明"最优控制 ≠ 最优性能"——模型假设和评价准则的匹配同样重要。

2. **引入空间维度 (PDE) 后**，加热器和恒温器的**位置**成为控制性能的主导因素。当恒温器远离加热器时，无论采用何种高级控制策略，系统都无法达到设定温度。

3. **加热器放在房间中心**是最优的位置配置。1D 模型中 RMSE 从 8.5°C（墙壁放置）降至 1.3°C（中心放置），2D 模型结果一致。

4. **实际工程建议**：先优化设备位置，再选择控制策略。如果位置已固定，PID 控制器（充分调参）是最实用的选择——它不需要精确的系统模型，通过积分项自动补偿建模误差。

---

## 参考文献

[1] Boyce WE, DiPrima RC, Meade DB. *Elementary Differential Equations and Boundary Value Problems*. 12th ed. Wiley; 2021.

[2] Strogatz SH. *Nonlinear Dynamics and Chaos*. 3rd ed. CRC Press; 2024.

[3] Åström KJ, Murray RM. *Feedback Systems: An Introduction for Scientists and Engineers*. 2nd ed. Princeton University Press; 2021. [免费在线: https://fbswiki.org]

[4] Goebel R, Sanfelice RG, Teel AR. *Hybrid Dynamical Systems: Modeling, Stability, and Robustness*. Princeton University Press; 2012.

[5] Zhang J, Johansson KH, Lygeros J, Sastry SS. Zeno hybrid systems. *Int J Robust Nonlinear Control*. 2001;11(5):435-451.

[6] Lygeros J, Johansson KH, Simic SN, Zhang J, Sastry SS. Dynamical properties of hybrid automata. *IEEE Trans Autom Control*. 2003;48(1):2-17.

[7] Strikwerda JC. *Finite Difference Schemes and Partial Differential Equations*. 2nd ed. SIAM; 2004.

[8] Blasco C, Monreal J, Benitez I, Lluna A. Modelling and PID control of HVAC system. In: *Trends in Practical Applications of Agents and Multiagent Systems*. Springer; 2012. p. 365-374.

[9] Anderson BDO, Moore JB. *Optimal Control: Linear Quadratic Methods*. Prentice-Hall; 1990. (Dover reprint, 2007.)

[10] Liberzon D. *Calculus of Variations and Optimal Control Theory: A Concise Introduction*. Princeton University Press; 2012.

[11] Kirk DE. *Optimal Control Theory: An Introduction*. Dover; 2004.

---

## 附录 A：物理参数表

| 参数 | 符号 | 值 | 单位 |
|------|------|----|----|
| 室外温度 | $T_a$ | 5 | °C |
| 初始室温 | $T_0$ | 10 | °C |
| 设定温度 | $T_{set}$ | 20 | °C |
| 最大加热率 | $U_{max}$ | 15 | °C/min |
| 冷却常数 | $k$ | 0.1 | min$^{-1}$ |
| 热扩散率 | $\alpha$ | 0.01 | m$^2$/min |
| 墙壁传热系数 | $h$ | 0.5 | m$^{-1}$ |
| 房间长度 | $L_x$ | 5 | m |
| 房间宽度 | $L_y$ | 4 | m |
| 滞回带半宽 | $\delta$ | 0.5 | °C |
| 仿真总时间 | $T_f$ | 120 | min |

## 附录 B：PID 参数搜索结果（前 10 名）

通过 100 组参数网格搜索，按统一代价 $J$ 排序：

| 排名 | $K_p$ | $K_i$ | $K_d$ | RMSE | 代价 $J$ |
|------|-------|-------|-------|------|----------|
| 1 | 8.0 | 1.0 | 0.0 | 0.442 | 25.01 |
| 2 | 8.0 | 0.5 | 0.0 | 0.443 | 25.33 |
| 3 | 8.0 | 1.0 | 0.5 | 0.443 | 25.38 |
| 4 | 4.0 | 1.0 | 0.0 | 0.480 | 26.98 |
| 5 | 8.0 | 0.5 | 0.5 | 0.444 | 25.61 |

高 $K_p$（快速响应）和适度 $K_i$（消除稳态误差）是关键，$K_d$ 对此一阶系统贡献甚微。
